<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Daily Crossword â€” Around the House</title>
<meta name="description" content="Daily Crossword â€” Around the House. Mobile-optimized grid with auto-save and clear answers.">
<style>
  :root{
    --teal:#1f9dbf; --gold:#f5b041; --bg:#faf9f6; --card:#ffffff;
    --thin:#ddd; --gold-shade:#faf1de; --num:#333; --num-stroke:#fff;
  }
  html,body{margin:0;padding:0;background:var(--bg);font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;
    display:flex;justify-content:center;-webkit-font-smoothing:antialiased;}
  .wrap{width:100%;max-width:980px;padding:18px;box-sizing:border-box;display:flex;justify-content:center}
  .card{width:100%;max-width:860px;background:var(--card);border-radius:12px;padding:16px;box-shadow:0 8px 20px rgba(0,0,0,.06)}
  .title{color:var(--teal);text-align:center;margin:0;font-size:clamp(1.05rem,3.6vw,1.6rem);font-weight:700}
  .subtitle{color:#333;text-align:center;margin:6px 0 2px;font-weight:600}
  .instructions{color:#666;text-align:center;margin:0 0 12px;font-size:.95rem;font-style:italic}
  .edit-note{color:#777;text-align:center;margin:0 0 8px;font-size:.9rem}
  .grid-wrap{display:flex;justify-content:center;margin:10px 0}
  .crossword{display:grid;gap:6px;width:min(700px,95vw);padding:8px;grid-template-columns:repeat(15,1fr)}
  .cell{position:relative;aspect-ratio:1/1;display:flex;align-items:center;justify-content:center;background:var(--card);
    border:1px solid var(--thin);overflow:hidden;font-family:monospace}
  .cell.block{background:var(--gold-shade)}
  .num{position:absolute;top:4px;left:6px;font-size:16px;font-weight:800;color:var(--num);
    text-shadow:-1px -1px 0 var(--num-stroke),1px -1px 0 var(--num-stroke),
                -1px 1px 0 var(--num-stroke),1px 1px 0 var(--num-stroke);cursor:pointer;user-select:none}
  .box{width:100%;height:100%;display:flex;align-items:center;justify-content:center;
    font-size:clamp(18px,3.5vw,28px);font-weight:700;font-family:monospace;text-transform:uppercase;
    background:transparent;line-height:1;outline:none;caret-color:#222}
  .box:focus{background:#e8f8fb}
  .controls{display:flex;justify-content:center;gap:10px;margin-top:12px;flex-wrap:wrap}
  button{padding:10px 14px;border-radius:8px;border:none;cursor:pointer;font-weight:700}
  .btn-gold{background:var(--gold);color:#222}
  .btn-teal{background:var(--teal);color:#fff}
  .clues{margin-top:16px;display:flex;gap:18px;flex-direction:column}
  @media(min-width:900px){.clues{flex-direction:row}}
  .clue-col{flex:1}
  .clue-col h4{margin:0 0 6px 0;color:var(--teal)}
  .clue{margin:6px 0;color:#222;white-space:pre-wrap;line-height:1.4}
  .toast{position:fixed;left:50%;bottom:18px;transform:translateX(-50%);background:var(--teal);color:#fff;
    padding:10px 14px;border-radius:10px;font-weight:700;box-shadow:0 8px 18px rgba(0,0,0,.15);
    opacity:0;pointer-events:none;transition:opacity .25s ease,transform .25s ease;z-index:9999}
  .toast.show{opacity:1;transform:translateX(-50%) translateY(-4px)}
</style>
</head>
<body>
<div class="wrap"><div class="card">
<h1 class="title">Daily Crossword</h1>
<div class="subtitle">Around the House</div>
<div class="instructions">Type letters into the boxes. Progress saves automatically.</div>
<div id="editNote" class="edit-note" style="display:none;">Edit mode: numbering changes are active.</div>
<div class="grid-wrap"><div id="grid" class="crossword"></div></div>
<div class="controls"><button id="clearBtn" class="btn-gold">ðŸ”„ Clear My Answers</button>
<button id="resetNumsBtn" class="btn-teal" style="display:none;">Reset Numbering</button></div>
<div class="clues">
  <div class="clue-col"><h4>Across</h4><div class="clue">3. Light switch locale
4. Handle on a door</div></div>
  <div class="clue-col"><h4>Down</h4><div class="clue">1. Cozy TV companion
2. Not dirty
4. Where the cook stirs things up
5. Bedroom furniture for rest</div></div>
</div></div></div>
<div id="toast" class="toast">âœ… Your previous progress has been restored.</div>

<script>
const relayURL = location.origin + '/storage.html';
const isEmbedded = (()=>{try{return window.self!==window.top}catch(_){return true}})();

let relayFrame, relayReady = false;
function setupRelay(){
  if(relayFrame) return;
  relayFrame = document.createElement('iframe');
  relayFrame.src = relayURL;
  relayFrame.style.display = 'none';
  document.body.appendChild(relayFrame);
  // Mark ready after a brief load delay
  setTimeout(()=>relayReady = true, 1500);
}

function postToRelay(msg){
  if(!relayReady) return;
  relayFrame.contentWindow.postMessage(msg, location.origin);
}

function askRelay(type,key,value){
  return new Promise(res=>{
    setupRelay();
    const msg={type,key,value};
    const handler=(e)=>{
      if(e.origin===location.origin && e.data?.key===key){
        window.removeEventListener('message',handler);
        res(e.data.value);
      }
    };
    window.addEventListener('message',handler);
    if(relayReady) relayFrame.contentWindow.postMessage(msg,location.origin);
    else setTimeout(()=>relayFrame.contentWindow.postMessage(msg,location.origin),1500);
  });
}

// Simple wrappers
async function saveData(k,v){try{await askRelay('set',k,v);}catch{}}
async function loadData(k){try{return await askRelay('get',k);}catch{return null}}
async function clearData(k){try{await askRelay('del',k);}catch{}}

const PUZ_ID='daily-xwd-relay';
const ANSWERS_KEY=PUZ_ID+':answers',NUMBERS_KEY=PUZ_ID+':numbers',CLEAR_FLAG=PUZ_ID+':cleared';
function setCookie(n,v,d){const x=new Date();x.setTime(x.getTime()+d*864e5);document.cookie=n+'='+encodeURIComponent(v)+';expires='+x.toUTCString()+';path=/'}
function getCookie(n){const m=document.cookie.match(new RegExp('(^|; )'+n+'=([^;]*)'));return m?decodeURIComponent(m[2]):''}

const ROWS=15,COLS=15,centerR0=1,centerC0=4;
const test13x6=[["#","","#","#","#","#"],["#","","#","#","#","#"],["#","","#","","#","#"],["","","","","#","#"],["#","#","#","","#","#"],["#","#","#","","#","#"],["#","#","","","",""],["#","#","","#","#",""],["#","#","","#","#",""],["#","#","","#","#","#"],["#","#","","#","#","#"],["#","#","","#","#","#"],["#","#","","#","#","#"]];
const TEMPLATE=Array.from({length:ROWS},()=>Array(COLS).fill("#"));
for(let r=0;r<test13x6.length;r++)for(let c=0;c<test13x6[0].length;c++)TEMPLATE[centerR0+r][centerC0+c]=test13x6[r][c]==="#"?"#":"";

function autoNumbers(){const n=Array.from({length:ROWS},()=>Array(COLS).fill(0));let k=1;for(let r=0;r<ROWS;r++)for(let c=0;c<COLS;c++){if(TEMPLATE[r][c]==="#")continue;const L=c===0||TEMPLATE[r][c-1]==="#",T=r===0||TEMPLATE[r-1]?.[c]==="#";if(L||T)n[r][c]=k++}return n;}
const gridEl=document.getElementById('grid'),toastEl=document.getElementById('toast');

async function buildGrid(){
  setupRelay();
  document.getElementById('editNote').style.display=isEmbedded?'none':'block';
  document.getElementById('resetNumsBtn').style.display=isEmbedded?'none':'inline-block';
  gridEl.innerHTML='';
  gridEl.style.gridTemplateColumns=`repeat(${COLS},1fr)`;
  let numbers=autoNumbers();
  let saved={};
  const a=await loadData(ANSWERS_KEY);if(a)saved=a;
  const n=await loadData(NUMBERS_KEY);if(n)numbers=n;
  const isCleared=getCookie(CLEAR_FLAG)==='true';
  for(let r=0;r<ROWS;r++){
    for(let c=0;c<COLS;c++){
      const val=TEMPLATE[r][c];
      const cell=document.createElement('div');cell.className='cell';
      if(val==="#"){cell.classList.add('block');}
      else{
        const lab=numbers[r][c]||0;
        if(lab){const num=document.createElement('div');num.className='num';num.textContent=lab;
          num.addEventListener('click',async e=>{
            e.stopPropagation();
            const v=prompt('Set number (leave blank to remove):',String(numbers[r][c]||''));if(v===null)return;
            const nv=v.trim();numbers[r][c]=nv===''?0:(isFinite(parseInt(nv,10))?parseInt(nv,10):numbers[r][c]);
            await saveData(NUMBERS_KEY,numbers);buildGrid();
          });cell.appendChild(num);}
        const box=document.createElement('div');box.className='box';box.contentEditable='true';
        const key=r+'-'+c;if(saved[key])box.textContent=saved[key];
        box.addEventListener('input',async()=>{
          let t=(box.textContent||'').toUpperCase().replace(/[^A-Z]/g,'');if(t.length>1)t=t.slice(-1);
          box.textContent=t;if(t)saved[key]=t;else delete saved[key];
          await saveData(ANSWERS_KEY,saved);setCookie(CLEAR_FLAG,'false',7);
        });
        cell.appendChild(box);
      }
      gridEl.appendChild(cell);
    }
  }
  if(Object.keys(saved).length>0){toastEl.classList.add('show');setTimeout(()=>toastEl.classList.remove('show'),3000);}
  document.getElementById('resetNumsBtn').onclick=async()=>{await clearData(NUMBERS_KEY);buildGrid();}
}
document.getElementById('clearBtn').addEventListener('click',async()=>{gridEl.querySelectorAll('.box').forEach(b=>b.textContent='');await clearData(ANSWERS_KEY);setCookie(CLEAR_FLAG,'true',7);});
buildGrid();
</script>
</body>
</html>
